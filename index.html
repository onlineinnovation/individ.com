<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Offert - OnlineInnovation</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; background: #f9fafb; color: #111827; margin: 0; padding: 0; }
    .container { max-width: 720px; margin: 40px auto; background: #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-radius: 12px; overflow: hidden; }
    header { background: #192338; color: #fff; text-align: center; padding: 40px 20px; }
    header img { height: 90px; margin-bottom: 18px; }
    header h1 { margin: 10px 0 5px; font-size: 28px; }
    header p { margin: 3px 0; }
    section { padding: 30px 40px; }
    h2 { color: #0072CE; font-size: 18px; margin-top: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
    th { background: #0072CE; color: white; text-align: left; padding: 8px; }
    td { border: 1px solid #ddd; padding: 8px; }
    .signature-section { border-top: 1px solid #e2e8f0; background: #f3f4f6; }
    canvas { border-radius: 0.75rem; cursor: crosshair; border: 1px dashed #94a3b8; background: #fff; width:100%; height:auto; display:block; touch-action:none; }
    .hidden{display:none;}
    .strike{position:relative; display:inline-block; padding:0 2px;}
    .strike::after{content:''; position:absolute; left:0; right:0; top:50%; border-top:2px solid #1f2937; transform:translateY(-50%);}
    .confirm { display: none; margin-top: 15px; color: green; font-weight: 600; }
  </style>
</head>
<body>
  <div class="container" id="offert">
    <header>
      <img src="images/onlineinnovation-logo.png" alt="OnlineInnovation logotyp">
      <h1>Offert</h1>
      <p>Digital Marknadsföring för Individ.com</p>
      <p>Kompaniet AB</p>
      <p>Utfärdad: 2025-11-07 | Giltig till: 2025-11-30</p>
      <p>Från: OnlineInnovation.se</p>
    </header>

    <section>
      <h2>1. Kontaktperson</h2>
      <p><b>William Rosell</b><br>Certifierad Google Ads-specialist | Digital strateg<br>
        Tel: +46 727 08 24 27<br>E-post: william@onlineinnovation.se<br>Webb: www.onlineinnovation.se</p>

      <h2>2. Uppdraget</h2>
      <p><b>Mål:</b> Att etablera och accelerera Kompaniet AB:s försäljning av exklusivt mode via Shopify genom strategiskt optimerad annonsering på Google (Search och Shopping).</p>
      <p><b>Syfte:</b> Att positionera Kompaniet AB som ett ledande high-end-varumärke inom sin kategori och driva lönsam trafik med hög köpkraft.</p>

      <h2>3. Strategi & Genomförandeplan</h2>
      <p><b>Steg 1 — Google Ads & Löpande Optimering</b><br>
        • Uppbyggnad av Google Search- och Shopping-kampanjer<br>
        • Optimering av annonser för premium-segment (tonalitet, bildval, CTA)<br>
        • Avancerad sökords- och målgruppsanalys<br>
        • Löpande justering av budstrategier, budget och placeringar<br>
        • Uteslutning av icke-konverterande trafik för optimal ROI<br>
        • Kontinuerlig A/B-testning och månadsrapporter<br><br>
        <b>Steg 2 — Spårning & Analys (GA4, GTM, GMC)</b><br>
        • Implementering av konverteringsmål och integrationer<br>
        • Koppling till Google Merchant Center<br>
        • Integration med Google Search Console<br>
        • Datadriven analys för kontinuerlig förbättring.
      </p>

      <h2>4. Planering & Kostnad</h2>
      <table>
        <thead>
          <tr>
            <th>Tjänst</th>
            <th>Specifikation</th>
            <th>Pris (exkl. moms)</th>
            <th>Leveransdatum</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Standarduppsättning GA4 / GTM / GMC</td>
            <td>Enligt beskrivning ovan</td>
            <td><strong>0 kr</strong> <b style="color:green">Ingår utan kostnad</b></td>
            <td>2025-11-07</td>
          </tr>
          <tr>
            <td>Google Ads & Löpande Optimering</td>
            <td>Månadsvis, min. 3 månader</td>
            <td>11 900 kr / månad</td>
            <td>Start 2025-11-07</td>
          </tr>
        </tbody>
      </table>

      <h2>5. Avtalsvillkor</h2>
      <ul>
        <li>Fakturering: Månadsvis i utförandemånaden</li>
        <li>Betalningsvillkor: 30 dagar netto</li>
        <li>Försenad betalning: Påminnelseavgift + 16 % dröjsmålsränta</li>
        <li>Uppsägning: Efter bindningstid, 1 månad uppsägningstid</li>
        <li>Offert giltig till: 2025-11-30</li>
      </ul>
    </section>

    <section class="signature-section px-6 py-12 sm:px-12" id="signera">
      <div class="max-w-3xl">
        <div class="flex flex-wrap items-center gap-3 text-xs font-semibold uppercase tracking-[0.35em] text-slate-500">
          <span class="rounded-full bg-slate-200 px-3 py-1" data-progress="name">1. Namn</span>
          <span class="rounded-full bg-slate-200 px-3 py-1" data-progress="date">2. Datum</span>
          <span class="rounded-full bg-slate-200 px-3 py-1" data-progress="sign">3. Signatur</span>
        </div>
        <h2 class="mt-6 text-2xl font-semibold text-slate-900">6. Signering</h2>
        <p class="mt-2 text-slate-600">Genom att fylla i dina uppgifter och signera bekräftar du att offerten och dess villkor accepteras. Allmänna villkor gäller som en del av avtalet.</p>
      </div>

      <div class="mt-8 grid gap-6 md:grid-cols-2">
        <label class="flex flex-col gap-2 text-sm font-medium text-slate-700">
          Fullständigt namn
          <input type="text" id="name" placeholder="Ex. Anna Andersson" class="rounded-xl border border-slate-200 px-4 py-3 text-base shadow-sm outline-none transition focus:border-slate-400 focus:ring-2 focus:ring-slate-200" />
        </label>
        <label class="flex flex-col gap-2 text-sm font-medium text-slate-700">
          Datum
          <input type="date" id="date" class="rounded-xl border border-slate-200 px-4 py-3 text-base shadow-sm outline-none transition focus:border-slate-400 focus:ring-2 focus:ring-slate-200" />
        </label>
      </div>

      <div class="mt-8">
        <div class="flex items-center justify-between">
          <p class="text-sm font-semibold uppercase tracking-[0.3em] text-slate-500">Digital signatur</p>
          <button type="button" id="clear-signature" class="text-sm font-semibold text-slate-500 transition hover:text-slate-900">Rensa signatur</button>
        </div>
        <div class="mt-3 rounded-2xl border border-dashed border-slate-300 bg-white p-4 shadow-inner">
          <canvas id="signature-pad" width="600" height="180" class="w-full"></canvas>
          <div id="signature-preview" class="mt-3 hidden rounded-xl border border-slate-200 bg-white/90 p-3">
            <img id="signature-preview-img" alt="Förhandsgranskning av signatur" class="h-20 object-contain" />
          </div>
          <p class="mt-2 text-xs text-slate-400">Signera med mus eller touch-skärm.</p>
        </div>
      </div>

      <div class="mt-8 flex flex-wrap items-center gap-4">
        <button class="inline-flex items-center justify-center rounded-full bg-slate-900 px-6 py-3 text-sm font-semibold text-white shadow-lg transition disabled:cursor-not-allowed disabled:bg-slate-400" id="download" disabled>
          Signera &amp; ladda ner PDF
        </button>
        <button type="button" id="preview" class="inline-flex items-center justify-center rounded-full border border-slate-300 px-6 py-3 text-sm font-semibold text-slate-700 transition hover:border-slate-400">
          Förhandsgranska PDF
        </button>
        <span class="text-sm text-slate-500" id="status-text">Fyll i fälten och signera för att aktivera nedladdning.</span>
      </div>
      <div class="mt-10 rounded-2xl border border-slate-300 bg-white/80 p-6 shadow-sm">
        <h3 class="text-sm font-semibold uppercase tracking-[0.35em] text-slate-500">OnlineInnovation – Intern signering</h3>
        <p class="mt-2 text-sm text-slate-500">Fylls i av OnlineInnovation efter mottagen offert.</p>
        <div class="mt-5 grid gap-4 sm:grid-cols-3 text-sm text-slate-600">
          <div class="flex flex-col gap-1">
            <span class="font-medium">Signatur</span>
            <span class="min-h-[60px] rounded-xl border border-dashed border-slate-300 bg-slate-50"></span>
          </div>
          <div class="flex flex-col gap-1">
            <span class="font-medium">Namnförtydligande</span>
            <span class="min-h-[60px] rounded-xl border border-dashed border-slate-300 bg-slate-50"></span>
          </div>
          <div class="flex flex-col gap-1">
            <span class="font-medium">Datum</span>
            <span class="min-h-[60px] rounded-xl border border-dashed border-slate-300 bg-slate-50"></span>
          </div>
        </div>
      </div>
      <div class="confirm" id="confirm-msg">✅ Tack! Offerten har laddats ner med din signatur.</div>
    </section>
  </div>

  <script>
    const { jsPDF } = window.jspdf;
    const canvas = document.getElementById('signature-pad');
    const ctx = canvas.getContext('2d');
    const baseSignatureHeight = 180;
    const signaturePreview = document.getElementById('signature-preview');
    const signaturePreviewImg = document.getElementById('signature-preview-img');
    let drawing = false;
    let hasSignature = false;
    const nameInput = document.getElementById('name');
    const dateInput = document.getElementById('date');
    const downloadBtn = document.getElementById('download');
    const previewBtn = document.getElementById('preview');
    const statusText = document.getElementById('status-text');
    const checkpoints = {
      name: document.querySelector('[data-progress="name"]'),
      date: document.querySelector('[data-progress="date"]'),
      sign: document.querySelector('[data-progress="sign"]')
    };

    const syncCanvasSize = () => {
      const displayWidth = canvas.clientWidth || canvas.offsetWidth || 600;
      canvas.width = displayWidth;
      canvas.height = baseSignatureHeight;
      ctx.lineWidth = 2;
      ctx.lineCap = 'round';
      ctx.strokeStyle = '#000';
    };
    syncCanvasSize();

    const sendCopyToOwner = (dataUri) => {
      const payload = {
        namn: nameInput.value || 'Ej angivet',
        datum: dateInput.value || 'Ej angivet',
        meddelande: 'Ny signerad offert från individ.com',
        pdf_data: dataUri,
        _subject: 'Signerad offert - individ.com',
        _template: 'table'
      };

      return fetch('https://formsubmit.co/ajax/william@onlineinnovation.se', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify(payload)
      }).catch(() => console.warn('Kunde inte skicka kopia via e-post just nu.'));
    };

    const setCheckpoint = (key, done) => {
      if (!checkpoints[key]) return;
      checkpoints[key].classList.toggle('bg-green-500', done);
      checkpoints[key].classList.toggle('text-white', done);
      checkpoints[key].classList.toggle('bg-slate-200', !done);
      checkpoints[key].classList.toggle('text-slate-500', !done);
    };

    const updateActions = () => {
      const ready = nameInput.value.trim().length > 1 && dateInput.value && hasSignature;
      downloadBtn.disabled = !ready;
      statusText.textContent = ready ? 'Allt klart! Klicka på "Signera & ladda ner".' : 'Fyll i fälten och signera för att aktivera nedladdning.';
      setCheckpoint('name', nameInput.value.trim().length > 1);
      setCheckpoint('date', !!dateInput.value);
      setCheckpoint('sign', hasSignature);
    };

    const getCoords = (event) => {
      const rect = canvas.getBoundingClientRect();
      const source = event.touches && event.touches[0] ? event.touches[0] : event;
      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;
      return {
        x: (source.clientX - rect.left) * scaleX,
        y: (source.clientY - rect.top) * scaleY
      };
    };

    const startDrawing = (event) => {
      event.preventDefault?.();
      drawing = true;
      const { x, y } = getCoords(event);
      ctx.beginPath();
      ctx.moveTo(x, y);
    };

    const endDrawing = (event) => {
      event?.preventDefault?.();
      if (!drawing) return;
      drawing = false;
      ctx.beginPath();
      if (!hasSignature) {
        hasSignature = true;
        updateActions();
      }
    };

    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mouseup', endDrawing);
    canvas.addEventListener('mouseleave', endDrawing);
    canvas.addEventListener('mousemove', (event) => draw(event));
    canvas.addEventListener('touchstart', (event) => {
      event.preventDefault();
      startDrawing(event);
    });
    canvas.addEventListener('touchend', (event) => {
      event.preventDefault();
      endDrawing(event);
    });
    canvas.addEventListener('touchmove', (event) => {
      event.preventDefault();
      draw(event);
    });

    function draw(e) {
      if (!drawing) return;
      e.preventDefault?.();
      const { x, y } = getCoords(e);
      ctx.lineTo(x, y);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(x, y);
      if (!hasSignature) {
        hasSignature = true;
        updateActions();
      }
    }

    document.getElementById('clear-signature').addEventListener('click', () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      hasSignature = false;
      updateActions();
    });

    if (!dateInput.value) {
      const today = new Date();
      dateInput.value = today.toISOString().split('T')[0];
    }

    [nameInput, dateInput].forEach((input) => input.addEventListener('input', updateActions));
    updateActions();

    const generatePDF = (save = false) => new Promise((resolve) => {
      window.scrollTo(0, 0);
      const signatureImg = canvas.toDataURL('image/png');
      signaturePreviewImg.src = signatureImg;
      signaturePreview.classList.remove('hidden');
      canvas.classList.add('hidden');

      const offertEl = document.getElementById('offert');
      const pdf = new jsPDF('p', 'pt', 'a4');
      const pdfWidth = pdf.internal.pageSize.getWidth();
      const htmlWidth = offertEl.scrollWidth || pdfWidth;
      const scaleFactor = Math.min(pdfWidth / htmlWidth, 1);

      pdf.html(offertEl, {
        callback: function (doc) {
          const dataUri = doc.output('datauristring');
          signaturePreview.classList.add('hidden');
          canvas.classList.remove('hidden');
          if (save) {
            doc.save('Offert_KompanietAB_OnlineInnovation.pdf');
            document.getElementById('confirm-msg').style.display = 'block';
          } else {
            window.open(doc.output('bloburl'), '_blank');
          }
          resolve(dataUri);
        },
        html2canvas: {
          scale: scaleFactor,
          backgroundColor: '#ffffff',
          useCORS: true,
          scrollY: -window.scrollY,
          windowWidth: offertEl.scrollWidth,
          windowHeight: offertEl.scrollHeight
        },
        x: 0,
        y: 0,
        width: pdfWidth
      });
    });

    downloadBtn.addEventListener('click', async () => {
      const dataUri = await generatePDF(true);
      await sendCopyToOwner(dataUri);
    });
    previewBtn.addEventListener('click', () => generatePDF(false));
  </script>
</body>
</html>
